<div class="container">
    <div class="section-header">
        <h1>Books on Shelf</h1>
        <button class="add-btn" (click)="onAddBook()">Add</button>
    </div>

    <!-- Loading and error states remain the same -->
    @if (errorMessage && !isLoading) {
    <div class="alert alert-error">
        {{ errorMessage }}
        <button class="alert-close" (click)="errorMessage = ''">&times;</button>
    </div>
    }

    @if (isLoading) {
    <div class="loading-state">
        <p>Loading books...</p>
    </div>
    }

    @if (!isLoading) {
    <!-- Your existing grid layout -->
    <div class="grid-header">
        <div class="grid-header-item">Title & Author</div>
        <div class="grid-header-item">Available Copies</div>
        <div class="grid-header-item">ISBN</div>
        <div class="grid-header-item">Publisher Year</div>
        <div class="grid-header-item">Status</div>
        <div class="grid-header-item">Actions</div>
    </div>

    @for (book of filteredBooks; track book.id) {
    <div class="grid-row">
        <div class="book-info">
            <img [src]="getImageUrl(book.img)" 
                 [alt]="book.title" 
                 class="book-cover"
                 (error)="book.img = 'assets/default-book-cover.jpg'">
            <div class="book-details">
                <h3>{{ book.title }}</h3>
                <p>{{ book.author }}</p>
            </div>
        </div>
        <div class="grid-cell copies-cell">
            <span class="copies-count">{{ book.available_copies }}</span>
            <span class="copies-label">available</span>
        </div>
        <div class="grid-cell">{{ book.ISBN }}</div>
        <div class="grid-cell">{{ book.publishYear }}</div>
        <div class="grid-cell">
            <span class="status-badge" [class.status-available]="book.available_copies > 0" [class.status-unavailable]="book.available_copies === 0">
                {{ book.available_copies > 0 ? 'Available' : 'Unavailable' }}
            </span>
        </div>
        <div class="actions">
            <button class="btn btn-update" (click)="onUpdate(book)">Update</button>
            <button class="btn btn-delete" (click)="onDelete(book)">Delete</button>
        </div>
    </div>
    }

    @if (filteredBooks.length === 0 && !isLoading) {
    <div class="no-results">
        <p>No books found matching "{{ searchQuery }}"</p>
    </div>
    }
    }

    <!-- Your Update Book Modal -->
    @if (showUpdateModal) {
    <div class="modal-overlay" (click)="closeUpdateModal()">
        <div class="popup-container" (click)="$event.stopPropagation()">
            <div class="popup-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </div>

            <h2 class="popup-title">Update Book</h2>
            <p class="popup-subtitle">Change information about book</p>

            <div class="book-preview">
                <img [src]="getImageUrl(selectedBook?.img || '')" 
                     [alt]="selectedBook?.title" 
                     class="book-cover-img">
            </div>

            <form (ngSubmit)="submitUpdate()">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Book Title</label>
                        <input type="text" class="form-input" 
                               [(ngModel)]="updateFormData.title" 
                               name="title" required>
                    </div>
                    <div class="form-group" style="max-width: 180px;">
                        <label class="form-label">Publish Year</label>
                        <input type="number" class="form-input" 
                               [(ngModel)]="updateFormData.publishYear" 
                               name="publishYear">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="max-width: 180px;">
                        <label class="form-label">Total Copies</label>
                        <input type="number" class="form-input" 
                               [(ngModel)]="updateFormData.total_copies" 
                               name="total_copies">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Author</label>
                        <input type="text" class="form-input" 
                               [(ngModel)]="updateFormData.author" 
                               name="author" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ISBN</label>
                        <input type="text" class="form-input" 
                               [(ngModel)]="updateFormData.ISBN" 
                               name="ISBN">
                    </div>
                    <div class="form-group" style="max-width: 180px;">
                        <label class="form-label">Pages</label>
                        <input type="number" class="form-input" 
                               [(ngModel)]="updateFormData.pages" 
                               name="pages">
                    </div>
                </div>

                <div class="button-row">
                    <button type="button" class="btn btn-cancel" (click)="closeUpdateModal()">Cancel</button>
                    <button type="submit" class="btn btn-update" [disabled]="isUpdating">
                        {{ isUpdating ? 'Updating...' : 'Update' }}
                    </button>
                </div>
            </form>
        </div>
    </div>
    }

    <!-- Your Delete Confirmation Modal -->
    @if (showDeleteModal) {
    <div class="modal-overlay" (click)="closeDeleteModal()">
        <div class="modal" (click)="$event.stopPropagation()">
            <div class="icon-container">
                <div class="warning-icon"></div>
            </div>

            <h2>Delete Book</h2>
            <p>Are you sure you want to delete "{{ bookToDelete?.title }}" by {{ bookToDelete?.author }}?</p>

            <div class="button-group">
                <button class="btn btn-discard" (click)="closeDeleteModal()">Cancel</button>
                <button class="btn btn-delete" (click)="confirmDelete()" [disabled]="isDeleting">
                    {{ isDeleting ? 'Deleting...' : 'Delete' }}
                </button>
            </div>
        </div>
    </div>
    }
</div>